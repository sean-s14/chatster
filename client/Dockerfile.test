FROM cypress/browsers:node-20.16.0-chrome-127.0.6533.88-1-ff-128.0.3-edge-127.0.2651.74-1

ARG NODE_ENV
ARG AUTH_TEST_EMAIL
ARG AUTH_TEST_PASSWORD
ARG VITE_BASE_URL
ARG VITE_SERVER_BASE_URL
ARG VITE_SSL_KEY_FILE
ARG VITE_SSL_CRT_FILE

ENV NODE_ENV=$NODE_ENV
ENV AUTH_TEST_EMAIL=$AUTH_TEST_EMAIL
ENV AUTH_TEST_PASSWORD=$AUTH_TEST_PASSWORD
ENV VITE_BASE_URL=$VITE_BASE_URL
ENV VITE_SERVER_BASE_URL=$VITE_SERVER_BASE_URL
ENV VITE_SSL_KEY_FILE=$VITE_SSL_KEY_FILE
ENV VITE_SSL_CRT_FILE=$VITE_SSL_CRT_FILE

WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
EXPOSE 3000
RUN npm run build
CMD ["npm", "run", "preview:test"]
